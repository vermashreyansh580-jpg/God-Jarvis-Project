name: Build VEGA God Mode
on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'
      
      - uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
      
      - name: Install System Dependencies
        run: |
          sudo apt-get update
          # Audio drivers for build process
          sudo apt-get install -y portaudio19-dev libasound2-dev
          
      - name: Install Python Libraries
        run: |
          # Pehle pip upgrade karo
          python -m pip install --upgrade pip
          # requirements.txt se sab install karo
          pip install -r requirements.txt
      
      - name: üöÄ Locate & Build APK
        run: |
          # 1. Main.py dhoondo
          TARGET_FILE=$(find . -name "main.py" -type f | head -n 1)
          
          if [ -z "$TARGET_FILE" ]; then
             echo "‚ùå Main.py nahi mili!"
             exit 1
          fi
          
          TARGET_DIR=$(dirname "$TARGET_FILE")
          cd "$TARGET_DIR"
          
          echo "‚úÖ Building in directory: $TARGET_DIR"
          echo "üìÇ Checking for Config File..."
          
          if [ -f "pyproject.toml" ]; then
             echo "‚úÖ pyproject.toml found! Permissions will be loaded."
          else
             echo "‚ö†Ô∏è WARNING: pyproject.toml nahi mila! Permissions shayad kaam na karein."
          fi
          
          # 2. Build Command (Verbose mode for details)
          # Hum '.' use kar rahe hain taaki wo pyproject.toml aur requirements.txt khud utha le
          yes | flet build apk . --verbose
          
      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: VEGA-GOD-MODE
          path: "**/*.apk"

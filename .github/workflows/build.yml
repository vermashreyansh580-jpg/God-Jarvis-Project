name: Build VEGA Auto-Find
on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'
      
      - uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
      
      - name: Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y portaudio19-dev libasound2-dev
          pip install flet requests SpeechRecognition pyttsx3 plyer
      
      - name: üîç Find main.py and Build
        run: |
          # Step 1: main.py ko dhoondo (pure repo mein kahin bhi ho)
          echo "Looking for main.py..."
          MAIN_FILE=$(find . -name "main.py" -type f | head -n 1)
          
          if [ -z "$MAIN_FILE" ]; then
            echo "‚ùå ERROR: main.py mili hi nahi! File name check karo (Main.py vs main.py)."
            ls -R
            exit 1
          fi
          
          # Step 2: Us folder mein jao jahan file mili
          echo "‚úÖ Found main.py at: $MAIN_FILE"
          TARGET_DIR=$(dirname "$MAIN_FILE")
          cd "$TARGET_DIR"
          
          echo "üìÇ Changing directory to: $TARGET_DIR"
          ls -la  # Check kar rahe hain ki file sach mein wahan hai
          
          # Step 3: Wahi se Build command chalao
          # Ab hum pyproject.toml par nirbhar nahi rahenge, direct command denge
          yes | flet build apk . --verbose
          
      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: VEGA-APK
          path: "**/*.apk" # Kahin bhi APK bane, utha lega
